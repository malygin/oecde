<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
     xmlns:ui="http://java.sun.com/jsf/facelets"
     xmlns:f="http://java.sun.com/jsf/core"
     xmlns:h="http://java.sun.com/jsf/html"
     template="../resources/adminTemplate.xhtml"
     xmlns:est="http://java.sun.com/jsf/composite/components/estimation">
    <ui:define name="content">
        <f:metadata>
            <f:viewParam name="id" value="#{studentViewBean.id}"/>
            <f:viewParam name="s" value="#{studentViewBean.semester}"/>
            <f:viewParam name="r" value="#{studentViewBean.testResultsBean.reExame}"/>
        </f:metadata>
        <div class="userFile">
            <div class="userPhoto">
                <table cellpadding="0" cellspacing="0">
                    <tr>
                        <td class="userPhotoBorder">
                            <h:graphicImage rendered="#{studentViewBean.student.mediumPhoto ne null}" value="../resources/userFiles/avatars/#{studentViewBean.student.mediumPhoto}"/>
                        </td>
                    </tr>
                    <tr>
                        <td>
                    <h:form>
                        <h:outputLink value="switch_user?j_username=#{studentViewBean.student.username}" >Зайти</h:outputLink>
                    </h:form>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="userData">
                <table cellspacing="8">
                    <tr>
                        <td><p>#{msgs.student_mainContentUserInfoSecondName}</p></td><td><div>#{studentViewBean.student.surname}</div></td>
                    </tr>
                    <tr>
                        <td><p>#{msgs.student_mainContentUserInfoFirstName}</p></td><td><div>#{studentViewBean.student.name}</div></td>
                    </tr>
                    <tr>
                        <td><p>#{msgs.student_mainContentUserInfoThirdName}</p></td><td><div>#{studentViewBean.student.secondName}</div></td>
                    </tr>
                    <tr style="display: none;">
                        <td><p>#{msgs.student_mainContentUserInfoBirthDay}</p></td><td><div>#{studentViewBean.student}</div></td>
                    </tr>
                    <tr>
                        <td><p>#{msgs.student_mainContentUserInfoFaculty}</p></td><td><div>#{studentViewBean.student.group.faculty}</div></td>
                    </tr>
                    <tr>
                        <td><p>#{msgs.student_mainContentUserInfoSpec}</p></td><td><div>#{studentViewBean.student.group.speciality.name}</div></td>
                    </tr>
                    <tr>
                        <td><p>#{msgs.student_mainContentUserInfoCourse}</p></td><td><div>#{studentViewBean.student.group.year}</div></td>
                    </tr>
                    <tr>
                        <td><p>#{msgs.student_mainContentUserInfoGroup}</p></td><td><div>#{studentViewBean.student.group.name}</div></td>
                    </tr>
                </table>
            </div>
            <div class="floatDestroyer"></div>
        </div>
        <est:changeSemester bean="#{studentViewBean}" link="id=#{studentViewBean.id}"/>

                <hr/><br/><h4>Оценки:</h4><br/><hr/>
        <h:dataTable  value="#{studentViewBean.gradesBean.points}"
                     columnClasses="studentStandatrTableTd,
                     studentStandatrTableTd,
                     studentStandatrTableTd,
                     studentStandatrTableTd,
                     studentStandatrTableTd,
                     studentStandatrTableTd,
                     studentStandatrTableTd,
                     studentStandatrTableTd,
                     studentStandatrTableTd,
                     studentStandatrTableTdLastTd" var="p" styleClass="studentStandatrTable" cellpadding="0" cellspacing="0">

            <h:column>
                <f:facet name="header">
                    <h:outputText value="#{msgs.student_gradesTableHeadDisc}" />
                </f:facet>
                <span class="controlWorksDisciplineName" style="font-size: 8pt;">#{p.points.curriculum.discipline.name}</span>
            </h:column>
            <h:column>
                <f:facet name="header">
                    <h:outputText value="#{msgs.student_gradesTableHeadTeacher}" />
                </f:facet>
                <span class="linkToTeachersProfile"><h:outputLink value="teacher.xhtml?id=${p.teacher.id}">#{p.teacher.initials}</h:outputLink></span>
            </h:column>
            <h:column>
                <f:facet name="header">
                    <h:outputText value="#{msgs.student_gradesTableHeadTests}" />
                </f:facet>
                #{p.test} (#{p.testsMaxPoints})
            </h:column>

            <h:column>
                <f:facet name="header">
                    <h:outputText value="#{msgs.student_gradesTableHeadResit}" />
                </f:facet>
                #{p.reTest}
            </h:column>

            <h:column>
                <f:facet name="header">
                    <h:outputText value="#{msgs.student_gradesTableHeadFinTests}" />
                </f:facet>
               #{p.concludingTest} (#{p.concludingTestsMaxPoints})
            </h:column>

            <h:column>
                <f:facet name="header">
                    <h:outputText value="#{msgs.student_gradesTableHeadFinTestsResit}" />
                </f:facet>
                #{p.concludingReTest}
            </h:column>

            <h:column>
                <f:facet name="header">
                    <h:outputText value="#{msgs.student_gradesTableHeadCWPoints}" />
                </f:facet>
                #{p.controlWorkPoints}
            </h:column>

            <h:column>
                <f:facet name="header">
                    <h:outputText value="#{msgs.student_gradesTableHeadCWs}" />
                </f:facet>
                <h:outputText converter="enumConverter" value="#{p.controlWorkValue}"/>
            </h:column>

            <h:column>
                <f:facet name="header">
                    <h:outputText value="#{msgs.student_gradesTableHeadSumm}" />
                </f:facet>
                #{p.points.sum}
            </h:column>

            <h:column>
                <f:facet name="header">
                    <h:outputText value="#{msgs.student_gradesTableHeadFinal}" />
                </f:facet>
                <h:outputText converter="enumConverter" value="#{p.grade}"/>
            </h:column>
        </h:dataTable>


        <hr/><br/><h4>Контрольные:</h4><br/><hr/>
        
        <h:dataTable width="100%" value="#{studentViewBean.controlWorksBean.controlWorks}" var="o">
            <h:column>
                <div class="studentInterfaceStandartList">
                    <div class="controlWorksControlTitle">
                        <span class="controlWorksDisciplineName">${o[0].discipline.name}</span>
                        <span class="linkToTeachersProfile" style="color:#669999;">(<h:outputLink value="teacher.xhtml?id=${o[3].id}">${o[3].initials}</h:outputLink>)</span>
                        <span class="chatPostDate" style="color: #AFAFAF; font-size: 10pt; margin: 0px;">(${o[1].points} - <h:outputText converter="enumConverter" value="${o[1].progress}"/>)</span>
                    </div>
                    <br/>
                    <ol style="padding-left: 25px; list-style: none;">
                        <li>
                            <ol style="padding-left: 25px; list-style: none;">
                                <h:dataTable value="#{o[1].cwAttempt}" var="a">
                                    <li class="downLoadFileLink"><h:outputText rendered="#{a.filePath eq 'empty'}" value="#{a.attemptDate}"/>
                                    <h:outputLink rendered="#{a.filePath ne 'empty'}" value="#{a.filePath}" id="log">
                                        <h:outputText value="#{a.attemptDate}"/>
                                    </h:outputLink>
                                    </li>
                                </h:dataTable>
                            </ol>
                        </li>
                    </ol>
                    <br/>
                </div>
                </h:column>
            </h:dataTable>

        <hr/><br/><h4>Тесты:<h:outputText rendered="#{testResultsBean.reExame}" value=" (переэкзаменовка)"/></h4><br/><hr/>
        <h:form id="form">
<h:commandLink value="#{msgs.student_eduMenuReexamination}">
    <f:attribute name="reExame" value="#{!testResultsBean.reExame}"/>
    <f:ajax render="form" listener="#{studentViewBean.reExameSwitch}"/>
</h:commandLink><br/>

<h:dataTable style="width: 100%;" value="#{studentViewBean.testResultsBean.attempts}" cellpadding="0" cellspacing="0"
             columnClasses="studentStandatrTableTd,
             studentStandatrTableTd,
             studentStandatrTableSubtableTd,
             studentStandatrTableTd,
             studentStandatrTableTdLastTd" styleClass="studentStandatrTable"  var="r">
    <h:column>
        <f:facet name="header">
            <h:outputText value="#{msgs.student_testResultName}" />
        </f:facet>
        <span class="controlWorksDisciplineName" style="font-size: 8pt;">#{r.work.title}</span>
    </h:column>
    <h:column>
        <f:facet name="header">
            <h:outputText value="#{msgs.student_testResultAttempt}" />
        </f:facet>
        #{testResultsBean.reExame?r.reExameAttemptsUsedNumber:r.estimateAttemptsUsedNumber} #{msgs.student_fromWord}
        #{testResultsBean.reExame?
           (r.work.type eq testConstantsServise.concludingType?testResultsBean.concludingAttemtpsCount:testResultsBean.regularAttemtpsCount)
        :r.work.quantity}
    </h:column>

    <h:column>
        <h:dataTable value="#{r.results}"
                     headerClass="studentTabInStandartTableTh"
                     columnClasses="studentTabInStandartTableLeftTd, studentTabInStandartTableRightTd"
                     styleClass="studentTabInStandartTable" cellpadding="0" cellspacing="0" var="a" id="rowId">
            <h:column>
                <f:facet name="header">
                    <div class="studentTabInStandartTableThContainer">
                        <h:outputText value="#{msgs.student_testResultCorrectAnswers}" />
                    </div>
                </f:facet>
                #{a.rightAnswers} #{msgs.student_fromWord} #{r.work.quantity}
           </h:column>
           <h:column>
                <f:facet name="header">
                    <div class="studentTabInStandartTableThContainer" style="border: 0px;">
                        <h:outputText value="#{msgs.student_testResultDate}" />
                    </div>
                </f:facet>
                #{a.date}
            </h:column>
        </h:dataTable>
    </h:column>

    <h:column>
        <f:facet name="header">
            <h:outputText value="#{msgs.student_testResultResult}" />
        </f:facet>
        #{r.pointsForWork}
    </h:column>
    <h:column>
        <f:facet name="header">
            <h:outputText value="#{msgs.student_testResultEstimationMethod}" />
        </f:facet>
        <h:outputText converter="enumConverter" value="#{r.work.estimation}" />
    </h:column>
</h:dataTable></h:form>
    </ui:define>

</ui:composition>
