    <ui:composition
         xmlns:ui="http://java.sun.com/jsf/facelets"
         xmlns:f="http://java.sun.com/jsf/core"
         xmlns:h="http://java.sun.com/jsf/html"
         xmlns:r="http://java.sun.com/jsp/jstl/core"
         template="../resources/studentTemplate.xhtml"
         >
        <ui:define name="content">
         <f:metadata>
             <f:viewParam name="c" value="#{testBean.curriculumId}"/>
             <f:viewParam name="id" value="#{testBean.testId}"/>
         </f:metadata>
       <span id="counter"></span><br/>

       <h:form id="mainForm">
         <h:panelGroup rendered="#{not testBean.renderTestPassing}">
           <h:outputText rendered="#{testBean.accessDenied}" value="Не найден или не доступен" />
           <h:outputLink value="discipline.xhtml?c=#{testBean.curriculumId}" styleClass="navigationLinks" style="display: block; margin-top: 5px;">назад</h:outputLink>
           <r:set var="t" value="#{testBean.test}"/>
           <r:set var="work" value="#{t[1]}"/>
           <r:set var="test" value="#{work.work}"/><br/>
           <r:choose>
               <r:when test="#{t[0]=='true'}">
                 <h:outputLink value="javascript:void(0)" styleClass="navigationLinks">#{test.title}</h:outputLink>
               </r:when>
               <r:otherwise>
                 <h:outputText  value="#{test.title}"/>
               </r:otherwise>
           </r:choose><br/>

           <h:outputText rendered="#{(t[2]!=null)&amp;&amp;(t[3]!=null)&amp;&amp;(t[4]!=null)}" style="color: red" value="#{t[2]}  ||  #{t[3]}  ||  #{t[4]}"/>
           <div style="text-align: left; width: 50%;position: relative; left: 35%;  margin-top: 10px; margin-bottom: 10px;">
               <table class="StudentTestStartPages">
                   <tr>
                       <td>
                        попыток:
                       </td>
                       <td>
                           #{work.estimateAttemptsUsedNumber} из #{test.estimateAttemptsNumber}
                       </td>
                   </tr>
                   <tr>
                       <td>
                        пробных:
                       </td>
                        <td> #{work.trialAttemptsUsedNumber} из #{test.trialNumber}
                        </td>
                   </tr>
                   <tr>
                       <td>
                        переэкзаменовка:
                       </td>
                        <td> #{work.reExameAttemptsUsedNumber}
                        </td>
                   </tr>
                   <tr>
                       <td>
                        доступен
                       </td>
                       <td>с #{test.openDate} по #{test.closeDate}
                       </td>
                   </tr>
                   <tr>
                       <td>
                        количество вопросов:
                       </td>
                        <td> #{test.quantity}
                        </td>
                   </tr>
                   <tr>
                       <td>
                        предоставленное время:
                        </td>
                            <td>#{test.duration}
                            </td>
                   </tr>
                   <tr>
                       <td>
                           Результаты тестирования:
                       </td>
                        <td> #{work.pointsForWork}
                        </td>
                   </tr>
                </table>
           </div>       
              <h:commandLink action="#{testBean.startTest}" rendered="#{not testBean.accessDenied}">Начать тест!
                  <f:ajax render="@form" />
              </h:commandLink>  
           </h:panelGroup>

        <h:panelGroup id="TestPassing" rendered="#{testBean.renderTestPassing}">              
                <script type="text/javascript" src="../resources/jquery/js/jquery-1.4.2.min.js"></script>
                <script type="text/javascript" src="../resources/jquery/js/jquery.jCountr.js"></script>
                <script type="text/javascript" src="../resources/scripts/test.js"></script>
                <script>
                      $(function(){
                            $("#counter").counter({
                                      min:'#{testPassingBean.timeTest}',
                                      sec:'0',
                                      message: 'Время вышло!',
                                      finish_function: 'checkTime()' });
                           });
                </script>
              <r:set var="question" value="#{testPassingBean.currentQustionView.question}"/>
             
                  <h:panelGroup id="mainPanel" rendered="#{not testPassingBean.renderCompleteTest}" >
                      отвечено на <span style="color: #373E3F; font-weight: bolder;">#{testPassingBean.countAnsweredquestion}</span> из <span style="color: #373E3F; font-weight: bolder;">#{testPassingBean.countQuestions}</span><br/>
                         <h:outputText escape="false" value="#{testPassingBean.questionTitle}" style="display: block; padding-top: 10px; margin: 0;"/><br/>
                         <h:panelGroup id="radioType" rendered="#{question.type=='radio'}" styleClass="educ_umk_text_block">
                             <h:selectOneRadio converter="testConverter" id="selectRadio"  layout="pageDirection" value="#{testPassingBean.selectedAnswer}">
                              <f:selectItems     value="#{testPassingBean.answers}"/><br/>
                            </h:selectOneRadio>
                         </h:panelGroup>

                          <h:panelGroup id="checkType" rendered="#{question.type=='check'}" styleClass="educ_umk_text_block">
                              <h:selectManyCheckbox converter="testConverter"  layout="pageDirection"  value="#{testPassingBean.selectedAnswers}" >
                                <f:selectItems   value="#{testPassingBean.answers}" /><br/>
                            </h:selectManyCheckbox >
                         </h:panelGroup>

                          <h:panelGroup id="textType" rendered="#{question.type=='text'}" styleClass="educ_umk_text_block">
                             <br/> <h:inputText value="#{testPassingBean.selectedAnswerText}" />
                         </h:panelGroup>
                          <h:panelGroup id="comparisonType" rendered="#{question.type=='comparison'}" style="position: relative; left: 40%;">
                              <div style="margin-top: 30px; margin-bottom: 30px;">
                              <ol style="text-align: left;">
                              <ui:repeat value="#{testPassingBean.answerComparisnView}"  var="a">
                                 <li> <h:outputText value="#{a.title}"/> --  <h:outputText value="#{a.title2}"/></li>
                              </ui:repeat>
                              </ol>
                              </div>
                              <div style="margin-top: 30px; margin-bottom: 30px;">
                              <ol  style="text-align: left;">
                              <ui:repeat value="#{testPassingBean.answerComparisnView}"  var="a">
                                  <li><h:inputText styleClass="numberField" onkeyup="
                                      if(isNaN(parseInt(this.value))){this.value='';}
                                      else{ if((this.value>#{testPassingBean.currentQustionView.countAnswers}) || (this.value&lt;1)) this.value=#{testPassingBean.currentQustionView.countAnswers};
                                             else this.value=parseInt(this.value)}
                                                   "  value="#{a.answer}">
                                      }
                                  </h:inputText>
                                  </li>
                              </ui:repeat>
                              </ol>
                                  </div>
                         </h:panelGroup>

                         <h:commandButton value="следующий" action="#{testPassingBean.next}" styleClass="studentButton" style="margin: 8px;">
                             <f:ajax render="@form"/>
                         </h:commandButton>

                         <h:commandButton value="ответить" action="#{testPassingBean.answer}" styleClass="studentButton"  style="margin: 8px;">
                              <f:ajax execute="@form" render="@form"/>
                         </h:commandButton>

                         <h:commandButton id="completeTest" onclick="removeCounter();" value="завершить тест" action="#{testPassingBean.completeTest}" styleClass="studentButton"  style="margin: 8px;">
                             <f:ajax render="@form"/>
                         </h:commandButton>

                 </h:panelGroup>

                 <h:panelGroup   rendered="#{testPassingBean.renderCompleteTest}">
                         <script type="text/javascript">
                               $(function(){
                                   $("#counter").remove();
                                   $(window).unbind('beforeunload');
                               });
                        </script>
                    тест успешно завершен!!
                    Баллов  #{testPassingBean.points} <br/>
                    Правильно ответил на  #{testPassingBean.countRight}
                 </h:panelGroup>
                 <h:messages/>
                 </h:panelGroup>
            </h:form>
   

  
        </ui:define>
    </ui:composition>