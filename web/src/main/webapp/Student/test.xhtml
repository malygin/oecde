    <ui:composition
         xmlns:ui="http://java.sun.com/jsf/facelets"
         xmlns:f="http://java.sun.com/jsf/core"
         xmlns:h="http://java.sun.com/jsf/html"
         xmlns:r="http://java.sun.com/jsp/jstl/core"
         xmlns:tests="http://java.sun.com/jsf/composite/components/tests"
         template="../resources/studentTemplate.xhtml">
          <f:metadata>
             <f:viewParam name="c" value="#{testBean.curriculumId}"/>
             <f:viewParam name="id" value="#{testBean.testId}"/>
         </f:metadata>
        <ui:define name="contentHeader">
             Прохождение теста -  "#{testBean.test[1].work.title}"
        </ui:define>

        <ui:define name="content">
        <script type="text/javascript" src="../resources/jquery/js/jquery.jCountr.js"></script>
        
	<script>
                //счетчик секунд для прогрессбара
                var pct=1;
                //блокатор на повторное создание счетчик
                 var flag=true;
       </script>
            <div class="counterPosition"><div class="TestCounter">
                   <span id="counter"></span>
            </div></div>

             <div>
                 <h:form id="mainForm">
                       <script type="text/javascript" src="../resources/scripts/test.js"></script>
                    <h:panelGroup rendered="#{not testBean.renderTestPassing}">
                       <h:outputText rendered="#{testBean.accessDenied}" value="Не найден или не доступен" />
                       <h:outputLink value="discipline.xhtml?c=#{testBean.curriculumId}" styleClass="navigationLinks backLinkPosition">назад</h:outputLink><br/>
                        <tests:showPreInfo t="#{testBean.test}" test="#{testBean.test[1].work}" work="#{testBean.test[1]}"/>
                        <h:commandLink action="#{testBean.startTest}" rendered="#{not testBean.accessDenied}" >Начать тест!
                              <f:ajax render="@form" />
                        </h:commandLink>
                    </h:panelGroup>

                    <h:panelGroup id="TestPassing" rendered="#{testBean.renderTestPassing}">
                            <script type="text/javascript" src="../resources/scripts/test.js"></script>
                            <script>
                                  $(function(){                                     
                                     if (flag){
                                         //идем в первый раз
                                            $("#counter").counter({
                                                      min:'#{testPassingBean.timeTest}',
                                                      sec:'0',
                                                      message: 'Время вышло!',
                                                          finish_function: 'checkTime()' });
                                             setInterval(function() {
                                                    $("#progressbar div.progress").css("width",pct*100/(#{testPassingBean.timeTest}*60)+"%");
                                                    pct++;
                                                }, 1000);
                                             flag=false;}

                                           });
                            </script>
                              <h:panelGroup id="mainPanel" rendered="#{not testPassingBean.renderCompleteTest}" >
                                 <tests:questionAnswer question="#{testPassingBean.currentQustionView.question}"/>
                                 <tests:questionProgressBars countAnsweredQuestion="#{testPassingBean.countAnsweredquestion}" countQuestions="#{testPassingBean.countQuestions}"/>
                                 <tests:questionTips type="#{testPassingBean.currentQustionView.question.type}"/>
                              </h:panelGroup>
                                 <h:panelGroup   rendered="#{testPassingBean.renderCompleteTest}">
                                        <script type="text/javascript">
                                               $(function(){
                                                   $("#counter").remove();
                                                   $(window).unbind('beforeunload');
                                               });
                                        </script>
                                        <a href="discipline.xhtml?c=#{testBean.curriculumId}"> Вернуться к курсу</a><br/>
                                     <tests:showResult countQuestions="#{testPassingBean.countQuestions}" countRight="#{testPassingBean.countRight}" points="#{testPassingBean.points}"/>
                                   </h:panelGroup>                             
                             </h:panelGroup>
                        </h:form>
               </div>
        </ui:define>
    </ui:composition>
